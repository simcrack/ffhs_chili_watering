<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.9.2" />
<title>ffhs_cws.web.frontend API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>ffhs_cws.web.frontend</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">import cherrypy
import os
import time
import dominate
import configparser
from dominate.tags import *

import settings
import persistanceLayer


class Frontend:
        &#34;&#34;&#34;Provides functions ans services related to the frontend.
        
        The functions can access HTML files in the web root and will replace some
        place holder with date (i.E. &lt;!--{{RuleRows}}--&gt;)
        &#34;&#34;&#34;

        def __init__(self, main):
                &#34;&#34;&#34;Instantiate a Frontend object.

                The server settings are loaded from the server.conf in the main conf directory.
                See also settings.py.

                Args:
                        main : reference to the Main object (for accessing other threads objects).
                &#34;&#34;&#34;
                conf = persistanceLayer.getWebServerConf(settings.BASECONFDIR)
                self._main = main
                self._baseWebDir = conf[&#34;baseWebDir&#34;]
                self._userPassword = conf[&#34;userPasswords&#34;]
                cherrypy.config.update(
                        {
                                &#34;server.socket_host&#34;: conf[&#34;host&#34;],
                                &#34;server.socket_port&#34;: conf[&#34;port&#34;],
                                &#34;engine.autoreload.on&#34;: False,
                        }
                )
                self._webConfig = {
                        &#34;/&#34;: {
                                &#34;tools.auth_basic.on&#34;: conf[&#34;authEnabled&#34;],
                                &#34;tools.auth_basic.realm&#34;: conf[&#34;authRealm&#34;],
                                &#34;tools.auth_basic.checkpassword&#34;: self._validatePassword,
                        }
                }

        def _validatePassword(self, realm, username, password):
                &#34;&#34;&#34;Validates a username/password configuration.
                Args:
                        realm : See specificaton for HTTP basic authentication.
                        username : See specificaton for HTTP basic authentication.
                        password : See specificaton for HTTP basic authentication.

                Returns:
                        True, if entered username/password matches else False.
                &#34;&#34;&#34;
                return (
                        username in self._userPassword and self._userPassword[username] == password
                )

        @cherrypy.expose
        def index(self, controllerNr: str = &#34;0&#34;):
                &#34;&#34;&#34;Is called if a user opens the main web page.

                Args:
                        controllerNr : Optional, if provided, the given controller is displayed.

                Returns:
                        A string containing the HTML page source code.
                &#34;&#34;&#34;
                html = &#34;&#34;
                with open(os.path.join(self._baseWebDir, &#34;index.html&#34;)) as f:
                        html = f.read()
                html = html.replace(
                        r&#34;&lt;!--{{ControllerRows}}--&gt;&#34;, self.getControllers().render()
                )
                html = html.replace(r&#34;&lt;!--{{Log}}--&gt;&#34;, self.getLog().render())

                if controllerNr != &#34;0&#34;:
                        html = html.replace(
                                r&#34;&lt;!--{{RuleRows}}--&gt;&#34;, self.getRules(int(controllerNr)).render()
                        )

                return html

        @cherrypy.expose
        def deleteRule(self, controllerNr: str = &#34;0&#34;, ruleName: str = &#34;&#34;):
                &#34;&#34;&#34;Deletes a rule from the config file and reload the backend.

                Args:
                        controllerNr : number of the controller AS STRING, whichs Rule shall be deleted.
                        ruleName : Name of the rule which shall be deleted.

                Return:
                        Nothing, redirects to index() with cherrypy.HTTPRedirect.
                &#34;&#34;&#34;
                persistanceLayer.deleteRule(settings.BASECONFDIR, int(controllerNr), ruleName)
                self._main.reload()
                raise cherrypy.HTTPRedirect(&#34;index&#34;)

        @cherrypy.expose
        def editRule(self, controllerNr: str, ruleName: str, **kwargs):
                &#34;&#34;&#34;Updates a rule in the config file and reload the backend.

                The function can also be used to create a new rule. For that, a rule name
                must be chosen which is not in use yet.

                Args:
                        controllerNr : number of the controller AS STRING, whichs Rule shall be modified.
                        ruleName : Name of the rule which shall be modified.
                        **kwargs : Key-value pairs which shall be written into the ini file.

                Return:
                        Nothing, redirects to index() with cherrypy.HTTPRedirect.
                &#34;&#34;&#34;

                if controllerNr == &#34;0&#34;:
                        return self.index()

                persistanceLayer.editRule(
                        settings.BASECONFDIR, int(controllerNr), ruleName, **kwargs
                )

                self._main.reload()
                raise cherrypy.HTTPRedirect(&#34;index&#34;)

        def run(self):
                &#34;&#34;&#34;Runs the cherrypy HTTP server.&#34;&#34;&#34;
                cherrypy.quickstart(self, &#34;/&#34;, self._webConfig)

        def stop(self):
                &#34;&#34;&#34;Stops the cherrypy HTTP server.&#34;&#34;&#34;
                cherrypy.engine.exit()

        def getControllers(self):
                &#34;&#34;&#34;Gets a HTML table representation of all loaded controllers.&#34;&#34;&#34;

                tbl = table(id=&#34;controllers&#34;)
                tbl.add(
                        thead(
                                tr(
                                        th(&#34;Nr&#34;),
                                        th(&#34;PumpNr&#34;),
                                        th(&#34;PumpState&#34;),
                                        th(&#34;ControllerType&#34;),
                                        th(&#34;SensorNr&#34;),
                                        th(&#34;SensorType&#34;),
                                        th(&#34;SensorValue&#34;),
                                        th(&#34;&#34;),
                                )
                        )
                )
                with tbl.add(tbody()):
                        for ctrl in self._main.controllers:
                                c = self._main.controllers[ctrl]
                                tr(
                                        td(ctrl),
                                        td(c.pumpNr),
                                        td(self._main.pumper.getPumpState(c.pumpNr)),
                                        td(c.__class__.__name__),
                                        td(c.sensor.nr),
                                        td(c.sensor.__class__.__name__),
                                        td(str(c.sensor.getValue() or &#34;&#34;)),
                                        td(
                                                input_(
                                                        value=&#34;Show rules&#34;,
                                                        onclick=&#34;window.location.href=&#39;/index?controllerNr=&#34;
                                                        + str(ctrl)
                                                        + &#34;&#39;&#34;,
                                                        type=&#34;submit&#34;,
                                                        cls=&#34;button&#34;,
                                                        id=&#34;controller_&#34; + str(ctrl),
                                                )
                                        ),
                                )
                return tbl

        def getRules(self, controllerNr: int):
                &#34;&#34;&#34;Gets a HTML table representation of all rules.

                Args:
                        controllerNr: Number of the controller.
                &#34;&#34;&#34;

                tbl = div(id=&#34;rules&#34;, cls=&#34;table&#34;)
                tbl.add(
                        thead(
                                div(
                                        span(&#34;Name&#34;, cls=&#34;th len-long type-str&#34;),
                                        span(&#34;From&#34;, cls=&#34;th len-mid type-time&#34;),
                                        span(&#34;To&#34;, cls=&#34;th len-mid type-time&#34;),
                                        span(&#34;&#34;, cls=&#34;th len-short type-str&#34;),
                                        span(&#34;Right Value&#34;, cls=&#34;th len-mid time-dec&#34;),
                                        span(&#34;Seconds&#34;, cls=&#34;th len-mshort time-int&#34;),
                                        span(&#34;&#34;, cls=&#34;th&#34;),
                                        span(&#34;&#34;, cls=&#34;th&#34;),
                                        cls=&#34;tr&#34;,
                                )
                        )
                )
                with tbl.add(tbody()):
                        measureRule = (
                                self._main.controllers[controllerNr].__class__.__name__
                                != &#34;TimeController&#34;
                        )
                        for rl in self._main.controllers[controllerNr].ruleSet:
                                if measureRule:
                                        self._getRuleRow(
                                                &#34;edit&#34;,
                                                controllerNr,
                                                rl.name,
                                                rl.timeFrom,
                                                rl.timeTo,
                                                rl.pumpSeconds,
                                                rl.comparator.asString(),
                                                rl.rValue,
                                        )
                                else:
                                        self._getRuleRow(
                                                &#34;edit&#34;,
                                                controllerNr,
                                                rl.name,
                                                rl.timeFrom,
                                                rl.timeTo,
                                                rl.pumpSeconds,
                                        )

                        self._getRuleRow(
                                &#34;new&#34;,
                                controllerNr,
                                &#34;&#34;,
                                &#34;00:00:00&#34;,
                                &#34;00:00:00&#34;,
                                &#34;0&#34;,
                                (lambda a: &#34;&lt;&#34; if a else None)(measureRule),
                                (lambda a: &#34;0&#34; if a else None)(measureRule),
                        )
                return tbl

        def _getRuleRow(
                self,
                rowType: str,
                controllerNr,
                name,
                timeFrom,
                timeTo,
                pumpSeconds,
                comparator=None,
                rValue=None,
        ):
                &#34;&#34;&#34;Gets a HTML table row representation of a rule with the given arguments.&#34;&#34;&#34;
                hiddenArg = {}
                readonlyArg = {}
                formId = &#34;&#34;
                if rowType == &#34;new&#34;:
                        hiddenArg[&#34;hidden&#34;] = &#34;&#34;
                        formId = &#34;newRule&#34;
                else:
                        readonlyArg[&#34;readonly&#34;] = &#34;&#34;
                        formId = &#34;rule_&#34; + str(controllerNr) + &#34;_&#34; + str(name)
                frm = form(id=formId, cls=&#34;tr&#34;, action=&#34;/editRule&#34;,)

                frm.appendChild(
                        input_(
                                type=&#34;text&#34;,
                                value=name,
                                name=&#34;ruleName&#34;,
                                cls=&#34;td len-long type-str&#34;,
                                **readonlyArg,
                                **hiddenArg,
                        )
                )

                frm.appendChild(
                        input_(
                                type=&#34;time&#34;,
                                value=timeFrom,
                                name=&#34;timeFrom&#34;,
                                cls=&#34;td len-mid type-time&#34;,
                                **hiddenArg,
                        )
                )

                frm.appendChild(
                        input_(
                                type=&#34;time&#34;,
                                value=timeTo,
                                name=&#34;timeTo&#34;,
                                cls=&#34;td len-mid type-time&#34;,
                                **hiddenArg,
                        )
                )

                if comparator == None:
                        # TimeRule or other non measuring.
                        frm.appendChild(
                                div(&#34;n/a&#34;, cls=&#34;td len-short type-str&#34;, name=&#34;comparator&#34;, **hiddenArg)
                        )
                        frm.appendChild(
                                div(&#34;n/a&#34;, cls=&#34;td len-mid type-int&#34;, name=&#34;rightValue&#34;, **hiddenArg)
                        )
                else:
                        # MeasureRule
                        frm.appendChild(
                                select(
                                        option(
                                                &#34;&lt;&#34;,
                                                **(lambda c: dict(selected=&#34;&#34;) if c == &#34;&lt;&#34; else dict())(
                                                        comparator
                                                ),
                                        ),
                                        option(
                                                &#34;&lt;=&#34;,
                                                **(lambda c: dict(selected=&#34;&#34;) if c == &#34;&lt;=&#34; else dict())(
                                                        comparator
                                                ),
                                        ),
                                        option(
                                                &#34;=&#34;,
                                                **(lambda c: dict(selected=&#34;&#34;) if c == &#34;=&#34; else dict())(
                                                        comparator
                                                ),
                                        ),
                                        option(
                                                &#34;&gt;=&#34;,
                                                **(lambda c: dict(selected=&#34;&#34;) if c == &#34;&gt;=&#34; else dict())(
                                                        comparator
                                                ),
                                        ),
                                        option(
                                                &#34;&gt;&#34;,
                                                **(lambda c: dict(selected=&#34;&#34;) if c == &#34;&gt;&#34; else dict())(
                                                        comparator
                                                ),
                                        ),
                                        value=comparator,
                                        name=&#34;comparator&#34;,
                                        cls=&#34;td len-short type-str&#34;,
                                        **hiddenArg,
                                )
                        )

                        frm.appendChild(
                                input_(
                                        type=&#34;number&#34;,
                                        value=rValue,
                                        name=&#34;rightValue&#34;,
                                        cls=&#34;td len-mid type-dec&#34;,
                                        **hiddenArg,
                                )
                        )

                frm.appendChild(
                        input_(
                                type=&#34;number&#34;,
                                value=pumpSeconds,
                                name=&#34;pumpSeconds&#34;,
                                min=&#34;0&#34;,
                                max=&#34;3600&#34;,
                                cls=&#34;td len-mshort type-int&#34;,
                                **hiddenArg,
                        )
                )

                frm.appendChild(
                        input_(type=&#34;hidden&#34;, name=&#34;controllerNr&#34;, value=controllerNr, **hiddenArg)
                )

                frm.appendChild(
                        input_(value=&#34;Save Changes&#34;, type=&#34;submit&#34;, cls=&#34;td button&#34;, **hiddenArg)
                )

                if rowType == &#34;new&#34;:
                        frm.appendChild(
                                input_(
                                        id=&#34;buttonCreateRule&#34;,
                                        value=&#34;Create rule&#34;,
                                        onclick=&#34;addRule()&#34;,
                                        type=&#34;button&#34;,
                                        cls=&#34;td button&#34;,
                                )
                        )
                else:
                        frm.appendChild(
                                input_(
                                        value=&#34;Delete rule&#34;,
                                        onclick=&#34;window.location.href=&#39;/deleteRule?controllerNr=&#34;
                                        + str(controllerNr)
                                        + &#34;&amp;ruleName=&#34;
                                        + name
                                        + &#34;&#39;&#34;,
                                        type=&#34;button&#34;,
                                        cls=&#34;td button&#34;,
                                )
                        )

                return frm

        def getLog(self):
                &#34;&#34;&#34;Returns a HTML list representation of the latest log entries.&#34;&#34;&#34;
                ls = ol(id=&#34;log&#34;)
                with open(settings.LOGFILE, &#34;r&#34;) as f:
                        for f in reversed(f.readlines()[-50:]):
                                ls.add(li(f, cls=&#34;logentry&#34;))
                return ls</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="ffhs_cws.web.frontend.Frontend"><code class="flex name class">
<span>class <span class="ident">Frontend</span></span>
<span>(</span><span>main)</span>
</code></dt>
<dd>
<div class="desc"><p>Provides functions ans services related to the frontend.</p>
<p>The functions can access HTML files in the web root and will replace some
place holder with date (i.E. <!--{{RuleRows}}-->)</p>
<p>Instantiate a Frontend object.</p>
<p>The server settings are loaded from the server.conf in the main conf directory.
See also settings.py.</p>
<h2 id="args">Args</h2>
<p>main : reference to the Main object (for accessing other threads objects).</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Frontend:
        &#34;&#34;&#34;Provides functions ans services related to the frontend.
        
        The functions can access HTML files in the web root and will replace some
        place holder with date (i.E. &lt;!--{{RuleRows}}--&gt;)
        &#34;&#34;&#34;

        def __init__(self, main):
                &#34;&#34;&#34;Instantiate a Frontend object.

                The server settings are loaded from the server.conf in the main conf directory.
                See also settings.py.

                Args:
                        main : reference to the Main object (for accessing other threads objects).
                &#34;&#34;&#34;
                conf = persistanceLayer.getWebServerConf(settings.BASECONFDIR)
                self._main = main
                self._baseWebDir = conf[&#34;baseWebDir&#34;]
                self._userPassword = conf[&#34;userPasswords&#34;]
                cherrypy.config.update(
                        {
                                &#34;server.socket_host&#34;: conf[&#34;host&#34;],
                                &#34;server.socket_port&#34;: conf[&#34;port&#34;],
                                &#34;engine.autoreload.on&#34;: False,
                        }
                )
                self._webConfig = {
                        &#34;/&#34;: {
                                &#34;tools.auth_basic.on&#34;: conf[&#34;authEnabled&#34;],
                                &#34;tools.auth_basic.realm&#34;: conf[&#34;authRealm&#34;],
                                &#34;tools.auth_basic.checkpassword&#34;: self._validatePassword,
                        }
                }

        def _validatePassword(self, realm, username, password):
                &#34;&#34;&#34;Validates a username/password configuration.
                Args:
                        realm : See specificaton for HTTP basic authentication.
                        username : See specificaton for HTTP basic authentication.
                        password : See specificaton for HTTP basic authentication.

                Returns:
                        True, if entered username/password matches else False.
                &#34;&#34;&#34;
                return (
                        username in self._userPassword and self._userPassword[username] == password
                )

        @cherrypy.expose
        def index(self, controllerNr: str = &#34;0&#34;):
                &#34;&#34;&#34;Is called if a user opens the main web page.

                Args:
                        controllerNr : Optional, if provided, the given controller is displayed.

                Returns:
                        A string containing the HTML page source code.
                &#34;&#34;&#34;
                html = &#34;&#34;
                with open(os.path.join(self._baseWebDir, &#34;index.html&#34;)) as f:
                        html = f.read()
                html = html.replace(
                        r&#34;&lt;!--{{ControllerRows}}--&gt;&#34;, self.getControllers().render()
                )
                html = html.replace(r&#34;&lt;!--{{Log}}--&gt;&#34;, self.getLog().render())

                if controllerNr != &#34;0&#34;:
                        html = html.replace(
                                r&#34;&lt;!--{{RuleRows}}--&gt;&#34;, self.getRules(int(controllerNr)).render()
                        )

                return html

        @cherrypy.expose
        def deleteRule(self, controllerNr: str = &#34;0&#34;, ruleName: str = &#34;&#34;):
                &#34;&#34;&#34;Deletes a rule from the config file and reload the backend.

                Args:
                        controllerNr : number of the controller AS STRING, whichs Rule shall be deleted.
                        ruleName : Name of the rule which shall be deleted.

                Return:
                        Nothing, redirects to index() with cherrypy.HTTPRedirect.
                &#34;&#34;&#34;
                persistanceLayer.deleteRule(settings.BASECONFDIR, int(controllerNr), ruleName)
                self._main.reload()
                raise cherrypy.HTTPRedirect(&#34;index&#34;)

        @cherrypy.expose
        def editRule(self, controllerNr: str, ruleName: str, **kwargs):
                &#34;&#34;&#34;Updates a rule in the config file and reload the backend.

                The function can also be used to create a new rule. For that, a rule name
                must be chosen which is not in use yet.

                Args:
                        controllerNr : number of the controller AS STRING, whichs Rule shall be modified.
                        ruleName : Name of the rule which shall be modified.
                        **kwargs : Key-value pairs which shall be written into the ini file.

                Return:
                        Nothing, redirects to index() with cherrypy.HTTPRedirect.
                &#34;&#34;&#34;

                if controllerNr == &#34;0&#34;:
                        return self.index()

                persistanceLayer.editRule(
                        settings.BASECONFDIR, int(controllerNr), ruleName, **kwargs
                )

                self._main.reload()
                raise cherrypy.HTTPRedirect(&#34;index&#34;)

        def run(self):
                &#34;&#34;&#34;Runs the cherrypy HTTP server.&#34;&#34;&#34;
                cherrypy.quickstart(self, &#34;/&#34;, self._webConfig)

        def stop(self):
                &#34;&#34;&#34;Stops the cherrypy HTTP server.&#34;&#34;&#34;
                cherrypy.engine.exit()

        def getControllers(self):
                &#34;&#34;&#34;Gets a HTML table representation of all loaded controllers.&#34;&#34;&#34;

                tbl = table(id=&#34;controllers&#34;)
                tbl.add(
                        thead(
                                tr(
                                        th(&#34;Nr&#34;),
                                        th(&#34;PumpNr&#34;),
                                        th(&#34;PumpState&#34;),
                                        th(&#34;ControllerType&#34;),
                                        th(&#34;SensorNr&#34;),
                                        th(&#34;SensorType&#34;),
                                        th(&#34;SensorValue&#34;),
                                        th(&#34;&#34;),
                                )
                        )
                )
                with tbl.add(tbody()):
                        for ctrl in self._main.controllers:
                                c = self._main.controllers[ctrl]
                                tr(
                                        td(ctrl),
                                        td(c.pumpNr),
                                        td(self._main.pumper.getPumpState(c.pumpNr)),
                                        td(c.__class__.__name__),
                                        td(c.sensor.nr),
                                        td(c.sensor.__class__.__name__),
                                        td(str(c.sensor.getValue() or &#34;&#34;)),
                                        td(
                                                input_(
                                                        value=&#34;Show rules&#34;,
                                                        onclick=&#34;window.location.href=&#39;/index?controllerNr=&#34;
                                                        + str(ctrl)
                                                        + &#34;&#39;&#34;,
                                                        type=&#34;submit&#34;,
                                                        cls=&#34;button&#34;,
                                                        id=&#34;controller_&#34; + str(ctrl),
                                                )
                                        ),
                                )
                return tbl

        def getRules(self, controllerNr: int):
                &#34;&#34;&#34;Gets a HTML table representation of all rules.

                Args:
                        controllerNr: Number of the controller.
                &#34;&#34;&#34;

                tbl = div(id=&#34;rules&#34;, cls=&#34;table&#34;)
                tbl.add(
                        thead(
                                div(
                                        span(&#34;Name&#34;, cls=&#34;th len-long type-str&#34;),
                                        span(&#34;From&#34;, cls=&#34;th len-mid type-time&#34;),
                                        span(&#34;To&#34;, cls=&#34;th len-mid type-time&#34;),
                                        span(&#34;&#34;, cls=&#34;th len-short type-str&#34;),
                                        span(&#34;Right Value&#34;, cls=&#34;th len-mid time-dec&#34;),
                                        span(&#34;Seconds&#34;, cls=&#34;th len-mshort time-int&#34;),
                                        span(&#34;&#34;, cls=&#34;th&#34;),
                                        span(&#34;&#34;, cls=&#34;th&#34;),
                                        cls=&#34;tr&#34;,
                                )
                        )
                )
                with tbl.add(tbody()):
                        measureRule = (
                                self._main.controllers[controllerNr].__class__.__name__
                                != &#34;TimeController&#34;
                        )
                        for rl in self._main.controllers[controllerNr].ruleSet:
                                if measureRule:
                                        self._getRuleRow(
                                                &#34;edit&#34;,
                                                controllerNr,
                                                rl.name,
                                                rl.timeFrom,
                                                rl.timeTo,
                                                rl.pumpSeconds,
                                                rl.comparator.asString(),
                                                rl.rValue,
                                        )
                                else:
                                        self._getRuleRow(
                                                &#34;edit&#34;,
                                                controllerNr,
                                                rl.name,
                                                rl.timeFrom,
                                                rl.timeTo,
                                                rl.pumpSeconds,
                                        )

                        self._getRuleRow(
                                &#34;new&#34;,
                                controllerNr,
                                &#34;&#34;,
                                &#34;00:00:00&#34;,
                                &#34;00:00:00&#34;,
                                &#34;0&#34;,
                                (lambda a: &#34;&lt;&#34; if a else None)(measureRule),
                                (lambda a: &#34;0&#34; if a else None)(measureRule),
                        )
                return tbl

        def _getRuleRow(
                self,
                rowType: str,
                controllerNr,
                name,
                timeFrom,
                timeTo,
                pumpSeconds,
                comparator=None,
                rValue=None,
        ):
                &#34;&#34;&#34;Gets a HTML table row representation of a rule with the given arguments.&#34;&#34;&#34;
                hiddenArg = {}
                readonlyArg = {}
                formId = &#34;&#34;
                if rowType == &#34;new&#34;:
                        hiddenArg[&#34;hidden&#34;] = &#34;&#34;
                        formId = &#34;newRule&#34;
                else:
                        readonlyArg[&#34;readonly&#34;] = &#34;&#34;
                        formId = &#34;rule_&#34; + str(controllerNr) + &#34;_&#34; + str(name)
                frm = form(id=formId, cls=&#34;tr&#34;, action=&#34;/editRule&#34;,)

                frm.appendChild(
                        input_(
                                type=&#34;text&#34;,
                                value=name,
                                name=&#34;ruleName&#34;,
                                cls=&#34;td len-long type-str&#34;,
                                **readonlyArg,
                                **hiddenArg,
                        )
                )

                frm.appendChild(
                        input_(
                                type=&#34;time&#34;,
                                value=timeFrom,
                                name=&#34;timeFrom&#34;,
                                cls=&#34;td len-mid type-time&#34;,
                                **hiddenArg,
                        )
                )

                frm.appendChild(
                        input_(
                                type=&#34;time&#34;,
                                value=timeTo,
                                name=&#34;timeTo&#34;,
                                cls=&#34;td len-mid type-time&#34;,
                                **hiddenArg,
                        )
                )

                if comparator == None:
                        # TimeRule or other non measuring.
                        frm.appendChild(
                                div(&#34;n/a&#34;, cls=&#34;td len-short type-str&#34;, name=&#34;comparator&#34;, **hiddenArg)
                        )
                        frm.appendChild(
                                div(&#34;n/a&#34;, cls=&#34;td len-mid type-int&#34;, name=&#34;rightValue&#34;, **hiddenArg)
                        )
                else:
                        # MeasureRule
                        frm.appendChild(
                                select(
                                        option(
                                                &#34;&lt;&#34;,
                                                **(lambda c: dict(selected=&#34;&#34;) if c == &#34;&lt;&#34; else dict())(
                                                        comparator
                                                ),
                                        ),
                                        option(
                                                &#34;&lt;=&#34;,
                                                **(lambda c: dict(selected=&#34;&#34;) if c == &#34;&lt;=&#34; else dict())(
                                                        comparator
                                                ),
                                        ),
                                        option(
                                                &#34;=&#34;,
                                                **(lambda c: dict(selected=&#34;&#34;) if c == &#34;=&#34; else dict())(
                                                        comparator
                                                ),
                                        ),
                                        option(
                                                &#34;&gt;=&#34;,
                                                **(lambda c: dict(selected=&#34;&#34;) if c == &#34;&gt;=&#34; else dict())(
                                                        comparator
                                                ),
                                        ),
                                        option(
                                                &#34;&gt;&#34;,
                                                **(lambda c: dict(selected=&#34;&#34;) if c == &#34;&gt;&#34; else dict())(
                                                        comparator
                                                ),
                                        ),
                                        value=comparator,
                                        name=&#34;comparator&#34;,
                                        cls=&#34;td len-short type-str&#34;,
                                        **hiddenArg,
                                )
                        )

                        frm.appendChild(
                                input_(
                                        type=&#34;number&#34;,
                                        value=rValue,
                                        name=&#34;rightValue&#34;,
                                        cls=&#34;td len-mid type-dec&#34;,
                                        **hiddenArg,
                                )
                        )

                frm.appendChild(
                        input_(
                                type=&#34;number&#34;,
                                value=pumpSeconds,
                                name=&#34;pumpSeconds&#34;,
                                min=&#34;0&#34;,
                                max=&#34;3600&#34;,
                                cls=&#34;td len-mshort type-int&#34;,
                                **hiddenArg,
                        )
                )

                frm.appendChild(
                        input_(type=&#34;hidden&#34;, name=&#34;controllerNr&#34;, value=controllerNr, **hiddenArg)
                )

                frm.appendChild(
                        input_(value=&#34;Save Changes&#34;, type=&#34;submit&#34;, cls=&#34;td button&#34;, **hiddenArg)
                )

                if rowType == &#34;new&#34;:
                        frm.appendChild(
                                input_(
                                        id=&#34;buttonCreateRule&#34;,
                                        value=&#34;Create rule&#34;,
                                        onclick=&#34;addRule()&#34;,
                                        type=&#34;button&#34;,
                                        cls=&#34;td button&#34;,
                                )
                        )
                else:
                        frm.appendChild(
                                input_(
                                        value=&#34;Delete rule&#34;,
                                        onclick=&#34;window.location.href=&#39;/deleteRule?controllerNr=&#34;
                                        + str(controllerNr)
                                        + &#34;&amp;ruleName=&#34;
                                        + name
                                        + &#34;&#39;&#34;,
                                        type=&#34;button&#34;,
                                        cls=&#34;td button&#34;,
                                )
                        )

                return frm

        def getLog(self):
                &#34;&#34;&#34;Returns a HTML list representation of the latest log entries.&#34;&#34;&#34;
                ls = ol(id=&#34;log&#34;)
                with open(settings.LOGFILE, &#34;r&#34;) as f:
                        for f in reversed(f.readlines()[-50:]):
                                ls.add(li(f, cls=&#34;logentry&#34;))
                return ls</code></pre>
</details>
<h3>Methods</h3>
<dl>
<dt id="ffhs_cws.web.frontend.Frontend.deleteRule"><code class="name flex">
<span>def <span class="ident">deleteRule</span></span>(<span>self, controllerNr: str = '0', ruleName: str = '')</span>
</code></dt>
<dd>
<div class="desc"><p>Deletes a rule from the config file and reload the backend.</p>
<h2 id="args">Args</h2>
<p>controllerNr : number of the controller AS STRING, whichs Rule shall be deleted.
ruleName : Name of the rule which shall be deleted.</p>
<h2 id="return">Return</h2>
<p>Nothing, redirects to index() with cherrypy.HTTPRedirect.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@cherrypy.expose
def deleteRule(self, controllerNr: str = &#34;0&#34;, ruleName: str = &#34;&#34;):
        &#34;&#34;&#34;Deletes a rule from the config file and reload the backend.

        Args:
                controllerNr : number of the controller AS STRING, whichs Rule shall be deleted.
                ruleName : Name of the rule which shall be deleted.

        Return:
                Nothing, redirects to index() with cherrypy.HTTPRedirect.
        &#34;&#34;&#34;
        persistanceLayer.deleteRule(settings.BASECONFDIR, int(controllerNr), ruleName)
        self._main.reload()
        raise cherrypy.HTTPRedirect(&#34;index&#34;)</code></pre>
</details>
</dd>
<dt id="ffhs_cws.web.frontend.Frontend.editRule"><code class="name flex">
<span>def <span class="ident">editRule</span></span>(<span>self, controllerNr: str, ruleName: str, **kwargs)</span>
</code></dt>
<dd>
<div class="desc"><p>Updates a rule in the config file and reload the backend.</p>
<p>The function can also be used to create a new rule. For that, a rule name
must be chosen which is not in use yet.</p>
<h2 id="args">Args</h2>
<p>controllerNr : number of the controller AS STRING, whichs Rule shall be modified.
ruleName : Name of the rule which shall be modified.
**kwargs : Key-value pairs which shall be written into the ini file.</p>
<h2 id="return">Return</h2>
<p>Nothing, redirects to index() with cherrypy.HTTPRedirect.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@cherrypy.expose
def editRule(self, controllerNr: str, ruleName: str, **kwargs):
        &#34;&#34;&#34;Updates a rule in the config file and reload the backend.

        The function can also be used to create a new rule. For that, a rule name
        must be chosen which is not in use yet.

        Args:
                controllerNr : number of the controller AS STRING, whichs Rule shall be modified.
                ruleName : Name of the rule which shall be modified.
                **kwargs : Key-value pairs which shall be written into the ini file.

        Return:
                Nothing, redirects to index() with cherrypy.HTTPRedirect.
        &#34;&#34;&#34;

        if controllerNr == &#34;0&#34;:
                return self.index()

        persistanceLayer.editRule(
                settings.BASECONFDIR, int(controllerNr), ruleName, **kwargs
        )

        self._main.reload()
        raise cherrypy.HTTPRedirect(&#34;index&#34;)</code></pre>
</details>
</dd>
<dt id="ffhs_cws.web.frontend.Frontend.getControllers"><code class="name flex">
<span>def <span class="ident">getControllers</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Gets a HTML table representation of all loaded controllers.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def getControllers(self):
        &#34;&#34;&#34;Gets a HTML table representation of all loaded controllers.&#34;&#34;&#34;

        tbl = table(id=&#34;controllers&#34;)
        tbl.add(
                thead(
                        tr(
                                th(&#34;Nr&#34;),
                                th(&#34;PumpNr&#34;),
                                th(&#34;PumpState&#34;),
                                th(&#34;ControllerType&#34;),
                                th(&#34;SensorNr&#34;),
                                th(&#34;SensorType&#34;),
                                th(&#34;SensorValue&#34;),
                                th(&#34;&#34;),
                        )
                )
        )
        with tbl.add(tbody()):
                for ctrl in self._main.controllers:
                        c = self._main.controllers[ctrl]
                        tr(
                                td(ctrl),
                                td(c.pumpNr),
                                td(self._main.pumper.getPumpState(c.pumpNr)),
                                td(c.__class__.__name__),
                                td(c.sensor.nr),
                                td(c.sensor.__class__.__name__),
                                td(str(c.sensor.getValue() or &#34;&#34;)),
                                td(
                                        input_(
                                                value=&#34;Show rules&#34;,
                                                onclick=&#34;window.location.href=&#39;/index?controllerNr=&#34;
                                                + str(ctrl)
                                                + &#34;&#39;&#34;,
                                                type=&#34;submit&#34;,
                                                cls=&#34;button&#34;,
                                                id=&#34;controller_&#34; + str(ctrl),
                                        )
                                ),
                        )
        return tbl</code></pre>
</details>
</dd>
<dt id="ffhs_cws.web.frontend.Frontend.getLog"><code class="name flex">
<span>def <span class="ident">getLog</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Returns a HTML list representation of the latest log entries.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def getLog(self):
        &#34;&#34;&#34;Returns a HTML list representation of the latest log entries.&#34;&#34;&#34;
        ls = ol(id=&#34;log&#34;)
        with open(settings.LOGFILE, &#34;r&#34;) as f:
                for f in reversed(f.readlines()[-50:]):
                        ls.add(li(f, cls=&#34;logentry&#34;))
        return ls</code></pre>
</details>
</dd>
<dt id="ffhs_cws.web.frontend.Frontend.getRules"><code class="name flex">
<span>def <span class="ident">getRules</span></span>(<span>self, controllerNr: int)</span>
</code></dt>
<dd>
<div class="desc"><p>Gets a HTML table representation of all rules.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>controllerNr</code></strong></dt>
<dd>Number of the controller.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def getRules(self, controllerNr: int):
        &#34;&#34;&#34;Gets a HTML table representation of all rules.

        Args:
                controllerNr: Number of the controller.
        &#34;&#34;&#34;

        tbl = div(id=&#34;rules&#34;, cls=&#34;table&#34;)
        tbl.add(
                thead(
                        div(
                                span(&#34;Name&#34;, cls=&#34;th len-long type-str&#34;),
                                span(&#34;From&#34;, cls=&#34;th len-mid type-time&#34;),
                                span(&#34;To&#34;, cls=&#34;th len-mid type-time&#34;),
                                span(&#34;&#34;, cls=&#34;th len-short type-str&#34;),
                                span(&#34;Right Value&#34;, cls=&#34;th len-mid time-dec&#34;),
                                span(&#34;Seconds&#34;, cls=&#34;th len-mshort time-int&#34;),
                                span(&#34;&#34;, cls=&#34;th&#34;),
                                span(&#34;&#34;, cls=&#34;th&#34;),
                                cls=&#34;tr&#34;,
                        )
                )
        )
        with tbl.add(tbody()):
                measureRule = (
                        self._main.controllers[controllerNr].__class__.__name__
                        != &#34;TimeController&#34;
                )
                for rl in self._main.controllers[controllerNr].ruleSet:
                        if measureRule:
                                self._getRuleRow(
                                        &#34;edit&#34;,
                                        controllerNr,
                                        rl.name,
                                        rl.timeFrom,
                                        rl.timeTo,
                                        rl.pumpSeconds,
                                        rl.comparator.asString(),
                                        rl.rValue,
                                )
                        else:
                                self._getRuleRow(
                                        &#34;edit&#34;,
                                        controllerNr,
                                        rl.name,
                                        rl.timeFrom,
                                        rl.timeTo,
                                        rl.pumpSeconds,
                                )

                self._getRuleRow(
                        &#34;new&#34;,
                        controllerNr,
                        &#34;&#34;,
                        &#34;00:00:00&#34;,
                        &#34;00:00:00&#34;,
                        &#34;0&#34;,
                        (lambda a: &#34;&lt;&#34; if a else None)(measureRule),
                        (lambda a: &#34;0&#34; if a else None)(measureRule),
                )
        return tbl</code></pre>
</details>
</dd>
<dt id="ffhs_cws.web.frontend.Frontend.index"><code class="name flex">
<span>def <span class="ident">index</span></span>(<span>self, controllerNr: str = '0')</span>
</code></dt>
<dd>
<div class="desc"><p>Is called if a user opens the main web page.</p>
<h2 id="args">Args</h2>
<p>controllerNr : Optional, if provided, the given controller is displayed.</p>
<h2 id="returns">Returns</h2>
<p>A string containing the HTML page source code.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@cherrypy.expose
def index(self, controllerNr: str = &#34;0&#34;):
        &#34;&#34;&#34;Is called if a user opens the main web page.

        Args:
                controllerNr : Optional, if provided, the given controller is displayed.

        Returns:
                A string containing the HTML page source code.
        &#34;&#34;&#34;
        html = &#34;&#34;
        with open(os.path.join(self._baseWebDir, &#34;index.html&#34;)) as f:
                html = f.read()
        html = html.replace(
                r&#34;&lt;!--{{ControllerRows}}--&gt;&#34;, self.getControllers().render()
        )
        html = html.replace(r&#34;&lt;!--{{Log}}--&gt;&#34;, self.getLog().render())

        if controllerNr != &#34;0&#34;:
                html = html.replace(
                        r&#34;&lt;!--{{RuleRows}}--&gt;&#34;, self.getRules(int(controllerNr)).render()
                )

        return html</code></pre>
</details>
</dd>
<dt id="ffhs_cws.web.frontend.Frontend.run"><code class="name flex">
<span>def <span class="ident">run</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Runs the cherrypy HTTP server.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def run(self):
        &#34;&#34;&#34;Runs the cherrypy HTTP server.&#34;&#34;&#34;
        cherrypy.quickstart(self, &#34;/&#34;, self._webConfig)</code></pre>
</details>
</dd>
<dt id="ffhs_cws.web.frontend.Frontend.stop"><code class="name flex">
<span>def <span class="ident">stop</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Stops the cherrypy HTTP server.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def stop(self):
        &#34;&#34;&#34;Stops the cherrypy HTTP server.&#34;&#34;&#34;
        cherrypy.engine.exit()</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="ffhs_cws.web" href="index.html">ffhs_cws.web</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="ffhs_cws.web.frontend.Frontend" href="#ffhs_cws.web.frontend.Frontend">Frontend</a></code></h4>
<ul class="two-column">
<li><code><a title="ffhs_cws.web.frontend.Frontend.deleteRule" href="#ffhs_cws.web.frontend.Frontend.deleteRule">deleteRule</a></code></li>
<li><code><a title="ffhs_cws.web.frontend.Frontend.editRule" href="#ffhs_cws.web.frontend.Frontend.editRule">editRule</a></code></li>
<li><code><a title="ffhs_cws.web.frontend.Frontend.getControllers" href="#ffhs_cws.web.frontend.Frontend.getControllers">getControllers</a></code></li>
<li><code><a title="ffhs_cws.web.frontend.Frontend.getLog" href="#ffhs_cws.web.frontend.Frontend.getLog">getLog</a></code></li>
<li><code><a title="ffhs_cws.web.frontend.Frontend.getRules" href="#ffhs_cws.web.frontend.Frontend.getRules">getRules</a></code></li>
<li><code><a title="ffhs_cws.web.frontend.Frontend.index" href="#ffhs_cws.web.frontend.Frontend.index">index</a></code></li>
<li><code><a title="ffhs_cws.web.frontend.Frontend.run" href="#ffhs_cws.web.frontend.Frontend.run">run</a></code></li>
<li><code><a title="ffhs_cws.web.frontend.Frontend.stop" href="#ffhs_cws.web.frontend.Frontend.stop">stop</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.9.2</a>.</p>
</footer>
</body>
</html>